# This is a basic workflow to help you get started with Actions

name: CI

env: 
  PROJECT_NAME:    PointCloudSegmentation
  BUILD_DIR:       docker-env
  DOCKER_REP_NAME: point_cloud_segmentation
on:
  fork:
  push:
    branches: [ dev, master ]
  pull_request:
    branches: [ master ]

jobs:
  codeStyle:
    runs-on: [ubuntu-latest]
    steps:
    - uses: actions/checkout@master
    - name: GitHub Action for Flake8
      uses: cclauss/GitHub-Action-for-Flake8@master
      with:
        args: flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics

    - uses: actions/checkout@v2
      name: Actions git repo
    - uses: peter-evans/autopep8@v1
      name: Autopep8
      with:
        args: --recursive --in-place --aggressive --aggressive .
  build:
    runs-on: ubuntu-latest
    needs: codeStyle
    steps:
    - uses: actions/checkout@v2
      name: Actions git repo
      env: 
        STATUS : ${{ job.status }}
     # - name: Docker login
     #   run: |
     #     docker login -u ${{ secrets.DOCKER_HUB_LOGIN }} -p ${{ secrets.DOCKER_HUB_PASSWORD }} docker.io
     # - name: Generate build number
     #   uses: einaregilsson/build-number@v2 
     #   with:
     #     token: ${{secrets.GIT_TOKEN}}        
     # - name: Print new build number
     #   run: echo "Build number is $BUILD_NUMBER"
     # - name: Docker build
     #   run: |
     #     ls
     #     docker build -t ${{ secrets.DOCKER_HUB_LOGIN }} $BUILD_DIR/
     #     docker tag ${{ secrets.DOCKER_HUB_LOGIN }} ${{ secrets.DOCKER_HUB_LOGIN }}/$DOCKER_REP_NAME:ver_$BUILD_NUMBER
     #     docker images
     # - name: Docker push
     #   run: |
     #     docker push ${{ secrets.DOCKER_HUB_LOGIN }}/$DOCKER_REP_NAME:ver_$BUILD_NUMBER
  notification:
    runs-on: ubuntu-latest
    needs: build
    steps:
    - uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_TO }}
        token: ${{ secrets.TELEGRAM_TOKEN }}
        message: |
          The ${{ github.event_name }} event from ${{ github.actor }}. Build ${{ env.PROJECT_NAME }} ${{ env.STATUS }}!
